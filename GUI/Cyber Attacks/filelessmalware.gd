extends Control

@onready var terminal: ColorRect = $Background/Terminal
@onready var terminal_icon: TextureButton = $Background/TerminalIcon
@onready var down_button: TextureButton = $"Background/Terminal/down button"

# msfvenom icons
@onready var msfvenom: Label = $Background/Terminal/msfvenom
@onready var msfvenom_server: Label = $"Background/Terminal/msfvenom/msfvenom server"
@onready var creating_payload_msfvenom: Label = $"Background/Terminal/msfvenom/creating payload"
@onready var output_payload: Label = $"Background/Terminal/msfvenom/output payload"
@onready var msfvenom_server_2: Label = $"Background/Terminal/msfvenom/msfvenom server2"
@onready var msfvenom_clear: Label = $"Background/Terminal/msfvenom/msfvenom clear"

var msfvenom_step := 0

# apache icons
@onready var apache: Label = $Background/Terminal/apache
@onready var apache_server: Label = $"Background/Terminal/apache/apache server"
@onready var apache_server_3: Label = $"Background/Terminal/apache/apache server3"
@onready var apache_server_4: Label = $"Background/Terminal/apache/apache server4"
@onready var creating_payload_apache: Label = $"Background/Terminal/apache/creating payload"
@onready var apache_start: Label = $"Background/Terminal/apache/apache start"
@onready var curl: Label = $Background/Terminal/apache/curl
@onready var curl_output: Label = $"Background/Terminal/apache/curl output"
@onready var apache_server_5: Label = $"Background/Terminal/apache/apache server5"
@onready var apache_clear: Label = $"Background/Terminal/apache/apache clear"
var apache_step := 0

# metasploit icons
@onready var metasploit: Label = $Background/Terminal/metasploit
@onready var _1_st_line: Label = $"Background/Terminal/metasploit/1st line"
@onready var _2_nd_line: Label = $"Background/Terminal/metasploit/2nd line"
@onready var _2_nd_line_part_2: Label = $"Background/Terminal/metasploit/2nd line part 2"
@onready var _3_rd_line: Label = $"Background/Terminal/metasploit/3rd line"
@onready var _4_th_line: Label = $"Background/Terminal/metasploit/4th line"
@onready var _5_th_line: Label = $"Background/Terminal/metasploit/5th line"
@onready var _6_th_line: Label = $"Background/Terminal/metasploit/6th line"
@onready var _7_th_line: Label = $"Background/Terminal/metasploit/7th line"
@onready var _8_th_line: Label = $"Background/Terminal/metasploit/8th line"
@onready var module_options: Label = $"Background/Terminal/metasploit/Module options"
@onready var payload_options: Label = $"Background/Terminal/metasploit/Payload options"
var metasploit_step := 0

func _ready() -> void:
	# Hide everything at the start
	terminal.visible = false

	msfvenom.visible = false
	msfvenom_server.visible = false
	creating_payload_msfvenom.visible = false
	output_payload.visible = false
	msfvenom_server_2.visible = false
	msfvenom_clear.visible = false

	apache.visible = false
	apache_server.visible = false
	apache_server_3.visible = false
	apache_server_4.visible = false
	creating_payload_apache.visible = false
	apache_start.visible = false
	curl.visible = false
	curl_output.visible = false
	apache_server_5.visible = false
	apache_clear.visible = false

	metasploit.visible = false
	_1_st_line.visible = false
	_2_nd_line.visible = false
	_2_nd_line_part_2.visible = false
	_3_rd_line.visible = false
	_4_th_line.visible = false
	_5_th_line.visible = false
	_6_th_line.visible = false
	_7_th_line.visible = false
	_8_th_line.visible = false
	module_options.visible = false
	payload_options.visible = false

	terminal_icon.pressed.connect(_on_terminal_icon_pressed)

func _on_terminal_icon_pressed():
	terminal.visible = true
	msfvenom.visible = true
	apache.visible = false
	metasploit.visible = false

func _unhandled_input(event):
	if event.is_action_pressed("ui_accept"):
		if terminal.visible and msfvenom.visible:
			_reveal_msfvenom_step()
			if msfvenom_clear.visible == true:
				msfvenom.visible = false
				apache.visible = true
		elif terminal.visible and apache.visible:
			_reveal_apache_step()
		elif terminal.visible and metasploit.visible:
			_reveal_metasploit_step()

func _reveal_msfvenom_step():
	match msfvenom_step:
		0:
			msfvenom_server.visible = true
		1:
			creating_payload_msfvenom.visible = true
		2:
			output_payload.visible = true
		3:
			msfvenom_server_2.visible = true
		4:
			msfvenom_clear.visible = true
	msfvenom_step += 1

func _reveal_apache_step():
	match apache_step:
		0:
			apache_server.visible = true
		1:
			apache_server_3.visible = true
		2:
			apache_server_4.visible = true
		3:
			creating_payload_apache.visible = true
		4:
			apache_start.visible = true
		5:
			curl.visible = true
		6:
			curl_output.visible = true
	apache_step += 1

func _reveal_metasploit_step():
	match metasploit_step:
		0:
			_1_st_line.visible = true
		1:
			_2_nd_line.visible = true
		2:
			_2_nd_line_part_2.visible = true
		3:
			_3_rd_line.visible = true
		4:
			_4_th_line.visible = true
		5:
			_5_th_line.visible = true
		6:
			_6_th_line.visible = true
		7:
			_7_th_line.visible = true
		8:
			_8_th_line.visible = true
		9:
			module_options.visible = true
		10:
			payload_options.visible = true
	metasploit_step += 1
